<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Fotos & Vídeos — Viagem</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="manifest" href="manifest.json">
  <link rel="stylesheet" href="style.css" />
</head>
<body class="bg-gray-50 text-gray-800">
  <header class="bg-white shadow p-4 sticky top-0 z-10">
    <div class="max-w-4xl mx-auto flex items-center justify-between">
      <h1 class="text-lg font-semibold">Fotos & Vídeos</h1>
      <nav class="text-sm space-x-4">
        <a href="index.html" class="text-sky-600">Início</a>
        <a href="roteiro.html" class="text-sky-600">Roteiro</a>
      </nav>
    </div>
  </header>

  <main class="max-w-4xl mx-auto p-4 space-y-4">
    <section class="card">
      <h2 class="font-semibold">Galeria</h2>
      <p class="small">Tire fotos direto do celular ou faça upload. Use templates rápidos para criar um "tumblr" estilizado.</p>

      <div class="mt-3 grid grid-cols-1 gap-3">
        <div class="flex gap-2">
          <input id="file-input" type="file" accept="image/*" multiple class="p-2 card" />
          <button id="open-camera" class="badge">Abrir Câmera</button>
        </div>

        <div class="mt-2 grid grid-cols-3 gap-2" id="gallery"></div>

        <div class="mt-4">
          <h4 class="font-semibold">Templates rápidos (para vídeos de casal)</h4>
          <p class="small">Escolha um template e clique em "Criar slideshow" para gerar uma página com transições que pode ser gravada.</p>
          <select id="template" class="p-2 card mt-2">
            <option value="romantic">Romântico - fades suaves com trilha lenta</option>
            <option value="adventure">Aventura - cortes rápidos e zooms</option>
            <option value="cinematic">Cinemático - barras pretas e letras grandes</option>
          </select>
          <div class="mt-2 flex gap-2">
            <button id="make-slideshow" class="badge">Criar slideshow</button>
            <button id="clear-gallery" class="text-sm text-red-600">Limpar galeria</button>
          </div>
        </div>
      </div>
    </section>
  </main>

  <script>
  const gallery = document.getElementById('gallery');
  const filesInput = document.getElementById('file-input');
  let images = JSON.parse(localStorage.getItem('viagem:photos')||'[]');

  function render(){
    gallery.innerHTML='';
    images.forEach((d,i)=>{
      const div = document.createElement('div');
      div.className='card p-1';
      div.innerHTML = `<img src="${d}" style="width:100%;height:120px;object-fit:cover;border-radius:8px" /> <div class="small mt-1 text-center"><button data-i="${i}" class="text-sm text-red-600">Remover</button></div>`;
      gallery.appendChild(div);
    });
    localStorage.setItem('viagem:photos', JSON.stringify(images));
  }

  filesInput.addEventListener('change', async (e)=>{
    const files = Array.from(e.target.files);
    for(const f of files){
      const data = await readFileAsDataURL(f);
      images.push(data);
    }
    render();
  });

  gallery.addEventListener('click', (ev)=>{
    const b = ev.target.closest('button');
    if(!b) return;
    const i = Number(b.dataset.i);
    images.splice(i,1); render();
  });

  document.getElementById('clear-gallery').addEventListener('click', ()=>{ if(confirm('Apagar todas as imagens?')){ images=[]; render(); }});

  function readFileAsDataURL(file){ return new Promise((res,rej)=>{ const fr = new FileReader(); fr.onload = ()=>res(fr.result); fr.onerror = rej; fr.readAsDataURL(file); }); }

  document.getElementById('open-camera').addEventListener('click', async ()=>{
    // open capture via input capture if available
    const inp = document.createElement('input'); inp.type='file'; inp.accept='image/*'; inp.capture='environment';
    inp.onchange = async (e)=>{ const f = e.target.files[0]; const data = await readFileAsDataURL(f); images.push(data); render(); };
    inp.click();
  });

  document.getElementById('make-slideshow').addEventListener('click', ()=>{
    if(images.length===0) return alert('Adicione algumas imagens primeiro');
    const tmpl = document.getElementById('template').value;
    const w = window.open('','_blank');
    const css = `body{margin:0;background:#000;color:#fff;display:flex;align-items:center;justify-content:center;height:100vh;} .slide{position:absolute;opacity:0;transition:opacity 1s ease;}.show{opacity:1}`;
    let html = `<html><head><title>Slideshow</title><style>${css}</style></head><body>`;
    images.forEach((src,i)=>{ html += `<img class="slide" id="s${i}" src="${src}" style="max-width:100vw;max-height:100vh;object-fit:contain" />`; });
    html += `<script>let idx=0;const slides=document.querySelectorAll('.slide'); function show(){ slides.forEach(s=>s.classList.remove('show')); slides[idx].classList.add('show'); idx=(idx+1)%slides.length; } setInterval(show, ${tmpl==='adventure'?1400:tmpl==='cinematic'?2400:3000}); show();</script></body></html>`;
    w.document.write(html); w.document.close();
  });

  // init
  render();
  </script>
</body>
</html>
